<!DOCTYPE html>
<html lang="en">
<head>
<title>미용실페이지</title>
<meta charset="UTF-8">
<meta name=description content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!--------------------------------------------------- jQuery ------------------------------------------>

<script src="./shop/js/jquery-2.2.0.js"></script>
<script src="./shop/js/commonjs.js"></script>
<script src="./shop/js/jquery-ui.js"></script>

<!------------------------------------ Bootstrap, CSS ------------------------------------------------->

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<link href="shop/css/shop.css" rel="stylesheet" media="screen" />
<link href="shop/css/bootstrap.min.css" rel="stylesheet" media="screen" />
<link href='https://fonts.googleapis.com/css?family=Syncopate' rel='stylesheet' type='text/css'>
<link rel="shortcut icon" href="../favicon.ico">
<link rel="stylesheet" type="text/css" href="./shop/css/style.css" />
<link href='http://fonts.googleapis.com/css?family=Lato:300,400,700'
	rel='stylesheet' type='text/css' />
<script type="text/javascript" src="./shop/js/modernizr.custom.79639.js"></script>
</head>
<body>

<!--------------------------------------------- 슬라이더 부분 ----------------------------------------------->
	
	<div class="wrap wrap-index">
		<div class="slider">
			<div class="jquery-reslider">
				<div class="slider-big">
				</div>
				
<!------------------------------------------------------- 상단 메뉴 버튼 ------------------------------------>				
				
				<div class="topbar">
					<div class="stitle"></div>
					<div class="icon">
						<button id="infoBtn" data-toggle="modal" data-target="#myModal"><i class="icon-info-sign"></i>Info</button>
						<button><i class="icon-time"></i>Reserve</button>
						<button><i class="icon-bookmark"></i>Bookmark</button>
						<button data-toggle="modal" data-target="#myModal2"><i class="icon-edit"></i>Edit</button>
					</div>
				</div>
		
<!-----------------------------------------------------info모달------------------------------------------>

				<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  			<div class="modal-dialog">
		    			<div class="modal-content">
		      				<div class="modal-header">
		        				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        				<h4 class="modal-title" id="myModalLabel"></h4>
		      				</div>
		      			<div class="modal-body">
		      				<div id="map" style="width: 100%; height: 300px;"></div>
		        			<div class="addr"></div>
		        			<div class="tel"></div>
		      			</div>
		    			</div>
		  			</div>
				</div>
		
<!-------------------------------------------------------------지도 스크립트-------------------------------->		

<script type="text/javascript" src="//apis.daum.net/maps/maps3.js?apikey=91c44d2bcf308d32698e4bce184444f8&libraries=services"></script>
<script>
// url 주소번호 ------------------------------------------------------------------
var lat = 0;
var lng = 0;
var currentViewDsnNo = $(location).attr('search').split("=")[1];
	console.log(currentViewDsnNo);
	
var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
    mapOption = {
        center: new daum.maps.LatLng(lat, lng), // 지도의 중심좌표
        level: 3 // 지도의 확대 레벨
    };  


// 지도를 생성합니다 

var map = new daum.maps.Map(mapContainer, mapOption); 
map.relayout();
// 주소-좌표 변환 객체를 생성합니다
var geocoder = new daum.maps.services.Geocoder();

// 주소로 좌표를 검색합니다
$(function() {
	$.getJSON(contextPath+"/shop/list.do",
			{sano:currentViewDsnNo},
		function(data) {
		console.log(data)
			geocoder.addr2coord(data.info[0].addr, function(status, result) {
				
			    // 정상적으로 검색이 완료됐으면 
			     if (status === daum.maps.services.Status.OK) {
			
			        var coords = new daum.maps.LatLng(result.addr[0].lat, result.addr[0].lng);
				
			        // 결과값으로 받은 위치를 마커로 표시합니다
			        var marker = new daum.maps.Marker({
			            map: map,
			            position: coords
			        });
				
			        // 인포윈도우로 장소에 대한 설명을 표시합니다
			        var infowindow = new daum.maps.InfoWindow({
			            content: '<div style="padding:5px;">' + data.info[0].name + '</div>'
			        });
			        infowindow.open(map, marker);
			    } 
			});    
		})
	})
</script>

<!----------------------------------------------------------edit모달------------------------------------->

				<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  			<div class="modal-dialog">
		    			<div class="modal-content">
		      				<div class="modal-header">
		        				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        				<h4 class="modal-title2" id="myModalLabel">Edit Box</h4>
		      				</div>
		      				<div class="modal-body">
		      					<div class="popup2">
								<form name="upload1" class="registForm">
									<div class="cobox">
										<input type="text" name="sano" style="display: none">
										<div class="etitle"></div>
										<div class="load">사진 1 파일 첨부
											<div class="sbtn">Search</div>
											<input type="file" name="file1" id="f1" class="file" onchange="readURL1(this);">
										</div>
										<div class="load">사진 2 파일 첨부
											<div class="sbtn">Search</div>
											<input type="file" name="file2" id="f2" class="file" onchange="readURL2(this);">
										</div>
										<div class="load">사진 3 파일 첨부
											<div class="sbtn">Search</div>
											<input type="file" name="file3" id="f3" class="file" onchange="readURL3(this);">
										</div>
										<div class="load">사진 4 파일 첨부
											<div class="sbtn">Search</div>
											<input type="file" name="file4" id="f4" class="file" onchange="readURL4(this);">
										</div>
										<div class="mibox">
											<div class="blah1"><img class="bbl1"></div>
											<div class="blah2"><img class="bbl2"></div>
											<div class="blah3"><img class="bbl3"></div>
											<div class="blah4"><img class="bbl4"></div>
										</div>
		            					<a class="close" href="http://192.168.0.7:8008/salon/shop/shop.html"></a>
										<div class="sub">
			 								<div onclick="registShop()" class="firm" data-dismiss="modal">Confirm</div>
										</div>
									</div>
								</form>
							</div> 
		      			</div>
		       			<!-- <div class="modal-footer">
		        			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		        			<button type="button" class="btn btn-primary">Save changes</button>
		      			</div> --> 
		    			</div>
		  			</div>
				</div>
			</div>
		</div>
	</div>
	
<!------------------------------------ 디자이너 슬라이드버튼 -------------------------------------------------->

	<div class="navl"><img src="./shop/images/prev3.png" class="prev"></div>
	<div class="navr"><img src="./shop/images/next3.png" class="next"></div>
	
<!---------------------------------------- 디자이너부분 ---------------------------------------------------->

	<div id="big">
		<div id="dsnpic1" class="pic">
			<div class="blog1">
				<div class="bp">
					<i class="fa fa-heart-o fa-4x"></i>
				</div>
				<div class="name"></div>
				<div class="move">
					<a href="http://192.168.0.44:8008/hair/blog/blog.html" class="blogm">블로그이동</a>
				</div>
			</div>
			<div class="slide1"></div>
		</div>
		<div id="dsnpic2" class="pic">
			<div class="blog1">
				<div class="bp">
					<i class="fa fa-heart-o fa-4x"></i>
				</div>
				<div class="name"></div>
				<div class="move">
					<a href="#" class="blogm">블로그이동</a>
				</div>
			</div>
			<div class="slide2"></div>
		</div>
		<div id="dsnpic3" class="pic">
			<div class="blog1">
				<div class="bp">
					<i class="fa fa-heart-o fa-4x"></i>
				</div>
				<div class="name"></div>
				<div class="move">
					<a href="#" class="blogm">블로그이동</a>
				</div>
			</div>
			<div class="slide3"></div>
		</div>
		<div id="dsnpic4" class="pic">
			<div class="blog1">
				<div class="bp">
					<i class="fa fa-heart-o fa-4x"></i>
				</div>
				<div class="name"></div>
				<div class="move">
					<a href="#" class="blogm">블로그이동</a>
				</div>
			</div>
			<div class="slide4"></div>
		</div>
		<div id="dsnpic5" class="pic">
			<div class="blog1">
				<div class="bp">
					<i class="fa fa-heart-o fa-4x"></i>
				</div>
				<div class="name"></div>
				<div class="move">
					<a href="#" class="blogm">블로그이동</a>
				</div>
			</div>
			<div class="slide5"></div>
		</div>
		<div id="dsnpic6" class="pic">
			<div class="blog1">
				<div class="bp">
					<i class="fa fa-heart-o fa-4x"></i>
				</div>
				<div class="name"></div>
				<div class="move">
					<a href="http://192.168.0.44:8008/hair/blog/blog.html" class="blogm">블로그이동</a>
				</div>
			</div>
			<div class="slide1"></div>
		</div>
		<div id="dsnpic7" class="pic">
			<div class="blog1">
				<div class="bp">
					<i class="fa fa-heart-o fa-4x"></i>
				</div>
				<div class="name"></div>
				<div class="move">
					<a href="#" class="blogm">블로그이동</a>
				</div>
			</div>
			<div class="slide2"></div>
		</div>
		<div id="dsnpic8" class="pic">
			<div class="blog1">
				<div class="bp">
					<i class="fa fa-heart-o fa-4x"></i>
				</div>
				<div class="name"></div>
				<div class="move">
					<a href="#" class="blogm">블로그이동</a>
				</div>
			</div>
			<div class="slide3"></div>
		</div>
		<div id="dsnpic9" class="pic">
			<div class="blog1">
				<div class="bp">
					<i class="fa fa-heart-o fa-4x"></i>
				</div>
				<div class="name"></div>
				<div class="move">
					<a href="#" class="blogm">블로그이동</a>
				</div>
			</div>
			<div class="slide4"></div>
		</div>
 		<div id="dsnpic10" class="pic">
			<div class="blog1">
				<div class="bp">
					<i class="fa fa-heart-o fa-4x"></i>
				</div>
				<div class="name"></div>
				<div class="move">
					<a href="#" class="blogm">블로그이동</a>
				</div>
			</div>
			<div class="slide5"></div>
		</div>
	</div>	

<!-------------------------------------------------- 화면끝 ---------------------------------------------->

	<div class="cloneslider" style="display: none;">
		<div class="slider-block" data-url="./shop/images/salon6.jpg"></div>
	</div>

<!--------------------------------------------- JavaScript --------------------------------------------->
<!-- jQuery if needed -->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="shop/js/jquery.reslider.js"></script>
<script>

	
	// 슬라이드 스크립트 ----------------------------------------------------------------
	
	$(function() {
		$('.jquery-reslider').reSlider({
			speed : 1000, //페이드속도
			delay : 5000, //자동전환 속도
			imgCount : 10, //이미지갯수
			dots : true, //하단 페이지 버튼
			autoPlay : true //자동재생
		})
	})
	
	// JSON 데이터 가져오기 -------------------------------------------------------------
	
	var shopAddr = "";
	var showPhotoList = function(){
		$.getJSON(contextPath+"/shop/list.do",
			{'sano':currentViewDsnNo},
			function(data){
				console.log(data);
				for(var i = 0; i < data.image.length; i++) {
					addSlider(data.image[i].path);
				}
				$("#myModalLabel").text(data.info[0].name);
			 	$(".stitle").text(data.info[0].name);
				$(".addr").text(data.info[0].addr);
				$(".tel").text(data.info[0].tel);
				$.getJSON("https://apis.daum.net/local/geo/addr2coord?apikey=91c44d2bcf308d32698e4bce184444f8&q="+data.info[0].addr+"&output=json",
						function(data2) {
							lat = data2.channel.item[0].lat;
							lng = data2.channel.item[0].lng;
							
							console.log("data2" + lat + "   " + lng);
							console.log(data2);
						}
				)
				for (var i = 0; i < data.dsn.length; i++) {
					$("#dsnpic" + (i+1)).find(".name").text(data.dsn[i].nick);
					$("#dsnpic" + (i+1)).css("background-image", "url('"+ data.dsn[i].photoPath +"')")
				}
		});
	};
	showPhotoList();
	// 이미지 업로드 ---------------------------------------------------------------------
	
	var registShop= function(){
		$("[name=sano]").val(currentViewDsnNo);
		var form = $(".registForm")[0];
		var formData = new FormData(form);
			$.ajax({
			   url: contextPath+"/shop/regist.do",
			   processData: false,
			   contentType: false,
			   data: formData,
			   type: 'POST',
			   success: function(data){
				   $(".slider-big").html("");
				   showPhotoList();
					return false;
			   }
			});
	}
	$(function() {
		$(".firm").click(function() {
			$(".file").val("");
			$(".bbl1").val("");
			$(".bbl2").val("");
			$(".bbl3").val("");
			$(".bbl4").val("");
		});
	})
	// 업로드 전 미리보기--------------------------------------------------------------------
	
 	function readURL1(input) {
		if(input.files&&input.files[0]) {
			var reader = new FileReader();
			reader.onload = function (e) {
				$(".bbl1").attr('src', e.target.result);
				$(".bbl1").css('opacity', 1);
				$(".bbl1").css('z-index', 99);
			}
			reader.readAsDataURL(input.files[0]);
		}
	}
 	function readURL2(input) {
		if(input.files&&input.files[0]) {
			var reader = new FileReader();
			reader.onload = function (e) {
				$(".bbl2").attr('src', e.target.result);
				$(".bbl2").css('opacity', 1);
				$(".bbl2").css('z-index', 99);
			}
			reader.readAsDataURL(input.files[0]);
		}
	}
 	function readURL3(input) {
		if(input.files&&input.files[0]) {
			var reader = new FileReader();
			reader.onload = function (e) {
				$(".bbl3").attr('src', e.target.result);
				$(".bbl3").css('opacity', 1);
				$(".bbl3").css('z-index', 99);
			}
			reader.readAsDataURL(input.files[0]);
		}
	}
 	function readURL4(input) {
		if(input.files&&input.files[0]) {
			var reader = new FileReader();
			reader.onload = function (e) {
				$(".bbl4").attr('src', e.target.result);
				$(".bbl4").css('opacity', 1);
				$(".bbl4").css('z-index', 99);
			}
			reader.readAsDataURL(input.files[0]);
		}
	}
 	
 	// 미리보기 더블클릭시 삭제함수 ------------------------------------------------------------
 	
 	$(function() {
 		$(".bbl1").dblclick(function() {
 			$(".bbl1").css("z-index", "0");
 			$(".bbl1").css("opacity", "0");
 		});
 	})
 	$(function() {
 		$(".bbl2").dblclick(function() {
 			$(".bbl2").css("z-index", "0");
 			$(".bbl2").css("opacity", "0");
 		});
 	})
 	$(function() {
 		$(".bbl3").dblclick(function() {
 			$(".bbl3").css("z-index", "0");
 			$(".bbl3").css("opacity", "0");
 		});
 	})
 	$(function() {
 		$(".bbl4").dblclick(function() {
 			$(".bbl4").css("z-index", "0");
 			$(".bbl4").css("opacity", "0");
 		});
 	})
 	
 	// 미용사 이미지 슬라이드함수---------------------------------------------------------------
 	var index = 0;
	$(function() {
		$(".prev").click(function() {
			if (index == 0)
				index = 5;
			else
				index--;
			move(index);
		});
		$(".next").click(function() {
			if (index == 5)
				index = 0;
			else
				index++;
			move(index);
		});
		var move = function(loc) {
			$("#big").animate({
				left : -(loc * 20)+"%"
			}, "slow");
		}
	});
 	var index = 0;
	$(function() {
		$(".navl").click(function() {
			if (index == 0)
				index = 5;
			else
				index--;
			move(index);
		});
		$(".navr").click(function() {
			if (index == 5)
				index = 0;
			else
				index++;
			move(index);
		});
		var move = function(loc) {
			$("#big").animate({
				left : -(loc * 20)+"%"
			}, "slow");
		}
	});
	
	// 클론DIV append 함수	----------------------------------------------------------------
	
	var addSlider = function(data) {
		var cloneSlider = $(".cloneslider").find(".slider-block").clone();
		cloneSlider.attr("data-url", data);
		$(cloneSlider).appendTo(".slider-big");
	}
	
	// 모달 호출 및 지도 위치 재지정 -------------------------------------------------------------
	$("#infoBtn").on("click", function() {
		console.log("lat" + lat + "lng" + lng)
		setTimeout(function(){
			map.setCenter(new daum.maps.LatLng(lat, lng));
			map.relayout();
		}, 300);
	});

	$('#myModal').on('show.bs.modal', function (e) {
		console.log('test');
	})

</script>
</body>
</html>
