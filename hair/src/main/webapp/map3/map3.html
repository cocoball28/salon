<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>주소로 장소 표시하기</title>
<script src="./js/jquery-2.2.0.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
<link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css' />
<link rel="stylesheet" href="../header/css/header.css">
<link rel="stylesheet" type="text/css" href="../header/css/style.css" />
<link rel="stylesheet" type="text/css" href="../header/css/noJS.css" />
<link rel="stylesheet" type="text/css" href="../header/css/modify.css" />
<script src="js/jquery-2.2.0.js"></script>
<script type="text/javascript" src="js/modernizr.custom.79639.js"></script> 
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script> 
<script src="../header/js/header.js"></script>
<style>
#map {
	margin: auto;
	margin-top: 3%;
	border-radius: 8px;
}
.bar {
	width: 50%;
	margin: auto;
	margin-top: 7%;
	height: 30px;
	background: #FCDED9;
	border-radius: 8px;
}
.rs {
	position: absolute;
	top: 25%;
	width: 20%;
	height: 75%;
	background: #EEEAE8;
	opacity: 0.5;
	left: 0%;
	overflow: scroll;
}
</style>
</head>
<body>
<header class="header"></header>
<section>
	<div class="bar"></div>
	<div id="map" style="width: 50%; height: 350px;"></div>
	<div class="rs"></div>
</section>

	<script type="text/javascript"
		src="//apis.daum.net/maps/maps3.js?apikey=91c44d2bcf308d32698e4bce184444f8&libraries=services"></script>
	<script>
		var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
		mapOption = {
			center : new daum.maps.LatLng(37.5059, 127.0212), // 지도의 중심좌표
			level : 3
		// 지도의 확대 레벨
		};

		// 지도를 생성합니다    "디비스크립트"
		var map = new daum.maps.Map(mapContainer, mapOption);

		// 주소-좌표 변환 객체를 생성합니다
		var geocoder = new daum.maps.services.Geocoder();

		// 주소로 좌표를 검색합니다
		$(function() {
			$.getJSON(contextPath+"/shop/list.do",
				function(data) {
				console.log(data);
				for(var i = 0; i < data.info.length; i++) {
					console.log(data);
					geocoder.addr2coord(data.info[i].addr, function(status, result) {
						// 정상적으로 검색이 완료됐으면 
						if (status === daum.maps.services.Status.OK) {
			
							var coords = new daum.maps.LatLng(result.addr[0].lat,
									result.addr[0].lng);
			
							// 결과값으로 받은 위치를 마커로 표시합니다
							var marker = new daum.maps.Marker({
								map : map,
								position : coords
							});
							var sinfo = "<div class='sinfo' style='width: 100%; height: 50px;'><div class='sname'></div></div>"
							daum.maps.event.addListener(marker, 'click', function() {
								$(".rs").append(sinfo);
							})
			
							// 인포윈도우로 장소에 대한 설명을 표시합니다
							var infowindow = new daum.maps.InfoWindow({
								content : '<div style="padding:5px;">' + data.info[i].name + '</div>'
							});							infowindow.open(map, marker);

						}
					});
				}
			})
		})
	</script>
<script>
function getContextPath(){
    var offset=location.href.indexOf(location.host)+location.host.length;
    var ctxPath=location.href.substring(offset,location.href.indexOf('/',offset+1));
    return ctxPath;
}


var contextPath =  getContextPath();
$(".header").load(contextPath+"/header/header.html .header");
</script>	
</body>
</html>